## Repository for integration tests between different modules (jBehave,Cucumber and so on)  

This project is used for testing different modules of Serenity BDD together.

If this build with tests executed successfully it means: 
 - build, test, integrationTests, install goals are executed "as-is" with success result for: serenity-core, serenity-jbehave, serenity-cucumber, serenity-maven-plugin, serenity-jira
 - build, test, integrationTests, install goals are executed with success result for serenity-jbehave, serenity-cucumber, serenity-maven-plugin, serenity-jira using configured serenity-core commit
 - build, test goals are executed goals are executed with success for test projects (smoke tests) against configured version of serenity-core, serenity-jbehave, serenity-cucumber, serenity-maven-plugin, serenity-jira

If this build failed - you can find gradle report with exceptions and descriptions for each failed module/test

As result all submodules will be tested against one version to be sure that all works fine. 

This project contains git submodules in last working-well-together version:

```
src/test/resources/projects/serenity-core           git@github.com:serenity-bdd/serenity-core.git
src/test/resources/projects/serenity-cucumber       git@github.com:serenity-bdd/serenity-cucumber.git
src/test/resources/projects/serenity-jbehave        git@github.com:serenity-bdd/serenity-jbehave.git
src/test/resources/projects/serenity-jira           git@github.com:serenity-bdd/serenity-jira.git
src/test/resources/projects/serenity-maven-plugin   git@github.com:serenity-bdd/serenity-maven-plugin.git
src/test/resources/projects/serenity-test-projects  git@github.com:serenity-bdd/serenity-test-projects.git
```

After checkout of this repo, you should init all submodules, and run build all submodules: 

```
git submodule update --init --recursive
./gradlew clean build
```

**IMPORTANT**:
current configuration can use parallel test execution and modules build, as result all modules and all test of modules execute in parallel - it can be resource consuming but will use resources of your PC in much more efficient way and make build much faster on powerful pc (tested with 22+ CPU cores and 20+ GB of RAM). 

## How It works

For each serenity module (serenity-core, serenity-jbehave, etc) created test with Spock framework. Each test execute against some project using temp folders generated by Spock(JUnit internally)

### Test for serenity-core
Test for serenity-core copy this project to temp folder, and fire gradle build for test, integrationTests, install goals. If all goals will be executed successfully and without fails - this test will be successful too

### Test for serenity-jbehave, serenity-cucumber, serenity-jira, serenity-maven-plugin (separate test for each module)
Test contains two steps:
 - checking if `test integrationTests install` finish successfully from repository "as-is" without any manipulation.
 - checking if `test integrationTest install` finish successfully using latest serenity-core commit. For this serenity-core is copied to temp folder and is build without any test execution, result artifacts are published to local maven repository with version X. After that target project (maven-plugin, jira, cucumber, etc ) copied to tmp folder and updated to use published serenity-core with version X. After that all goals are executed for target project (`test integrationTest install`) and output is checked to be success. If this test finished successfully means that this module can work with latest serenity-core commit.

### Test using serenity-test-projects
This test contains some example projects that should be build with serenity and aggregation reports should be created. They are real projects, with real tests. After build finished output is checked if it is the same as expected. To achieve this serenity-core builds without tests and published to local maven repo with  


## Workflows to work with this project

### Update all serenity-modules to last version
Can be used when you want update submodules to check how they work together (last commit in each). In this example each submodule has upstream (serenity-bdd/reponame) amd origin - forked repository (some-name/reponame)

From serenity-module-integrations project dir if you are working in forked repository
```
git submodule foreach git checkout master
git submodule foreach git fetch upstream
git submodule foreach git merge master upstream/master
git submodule foreach git push origin -u master

```
if you are working with origin repository

```
git pull origin
git submodule foreach git pull origin master -f
```

after this commands, if they are executed successfully all submodules will be on last version. So now build ''' ./gradlew clean build''' will be executed with latest version of all submodules

### Build all projects

To build all projects, run all test and integrationTests you should execute only one command from serenity-module-integrations project dir:

```
./gradlew clean build
```

now all projects are build, tested and worked well (at current version of submodules off-cause). Yes it so easy!

### Run smoke tests with latest serenity-core, serenity-maven, serenity-gradle-plugin, etc.

For now we have serenity-core/smoke-test, and it already merged in this repository with name junit-serenity-test.
In this project defined serenity-test-projects - it is projects, that contains smoke and integration tests for serenity-core, serenity-jbehave, serenity-cucumber, serenity-gradle-plugin, serenity-manve-plugin, etc.  
 
To build only smoke-test with latest version (latest commit in master) of serenityc-core serenity modules you should:

 1. clone this repo to some folder
 2. update all submodules to last version
 3. run test only of class WhenBuildingSerenityTestProjects

Don't worry about any serenity module versions in build scripts - they will be updated during build process. 
In some nearest future all reports will be checked as well (all statistics in reports) - for now this build will success only if all test projects will execute without any fail.

all in one script if you did not checkout project before:
```
git clone git@github.com:serenity-bdd/serenity-module-integrations.git 
cd serenity-module-integrations
git submodule update  --init --recursive
git submodule foreach git pull origin master -f
./gradlew clean test -Dtest.single=WhenBuildingWebTodoMVCProject
```

all in one script in you have checkouted project, should be executed from project dir :
```
git checkout master -f
git submodule foreach git checkout master -f
git pull origin master -f
git submodule foreach git pull origin master -f
./gradlew clean test -Dtest.single=WhenBuildingWebTodoMVCProject
```

### Run build of test project in particular dir to check results manually
For now this does not supported - but it can be done by updating one line:
```
def File location = temporary.getRoot()
```
to 
```
def File location = new File("myPath")
```

As result all modules for this test will be copied to destination folder, and compiled here. For example, if it will be done for WhenBuildingWebTodoMVCProject:
 - serenity-core will be in folder `myPath/serenity-core`, compiled and published to maven local repository with version X
 - serenity-jbehave will ne in folder `myPath/serenity-jbehave`, dependency of serenity-core will be updated to version X. Serenity-jbehave will be published to maven local repository with version Y.
 - web-todomvc-project will be in folder `myPath/web-todomvc-project`, dependency of serenity-core will be updated to version X and serenity-jbehave to version Y. This project will be executed using updated versions, all tests and aggregate gradle goal. Reports will in `myPath/web-todomvc-project/target/serenity/site` as usual.   

## Next goals
Build test projects using mvn:
using maven api execute projects with maven to check how serenity-maven-plugin works using [maven-invoker](http://maven.apache.org/shared/maven-invoker/usage.html)


    
    
